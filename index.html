<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Turn On All The Lights - Multiplayer + Chat</title>
  <style>
    :root{--bg:#0f1724;--on:#f6e05e;--off:#1f2937;--accent:#60a5fa}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui}
    body{background:linear-gradient(180deg,var(--bg),#071025);display:flex;align-items:center;justify-content:center;padding:20px;color:#e6eef8}
    .app{width:min(700px,96vw);background:rgba(255,255,255,0.03);border-radius:12px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    h1{font-size:20px;margin:0 0 16px 0;text-align:center}
    .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;justify-items:center;margin-bottom:20px}
    .light{width:56px;height:56px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;user-select:none;font-weight:700;box-shadow:inset 0 -4px 12px rgba(0,0,0,0.4)}
    .off{background:var(--off);color:#9aa7b7}
    .on{background:linear-gradient(180deg,var(--on),#d9b94a);color:#111;font-size:14px}
    .status{text-align:center;margin-top:14px;color:#bcd3f6}
    .score{text-align:center;margin-top:6px;color:#f6e05e;font-weight:bold}
    .chat{margin-top:20px}
    .messages{max-height:150px;overflow-y:auto;background:rgba(255,255,255,0.05);padding:8px;border-radius:8px;margin-bottom:8px;font-size:14px}
    .msg{margin-bottom:4px}
    .input-row{display:flex;gap:6px}
    .input-row input{flex:1;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#fff}
    .input-row button{padding:6px 10px;border:none;border-radius:6px;background:var(--accent);color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="app">
    <h1>Turn On All The Lights (Multiplayer)</h1>
    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="status" class="status">Connecting...</div>
    <div id="score" class="score">Times completed: 0</div>

    <div class="chat">
      <div id="messages" class="messages"></div>
      <div class="input-row">
        <input id="chatInput" type="text" placeholder="Type a message..." />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, onChildAdded, onValue, push, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // Your Firebase project config
    const firebaseConfig = {
      apiKey: "AIzaSyD6iAQ5xRisAWwtGcBLPOAG631AoDFCfAg",
      authDomain: "lightbulb-cf2bf.firebaseapp.com",
      databaseURL: "https://lightbulb-cf2bf-default-rtdb.firebaseio.com",
      projectId: "lightbulb-cf2bf",
      storageBucket: "lightbulb-cf2bf.appspot.com",
      messagingSenderId: "174317057230",
      appId: "1:174317057230:web:8b494ca4c373764bfc4c9f",
      measurementId: "G-026SPFXV9M"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const gridEl = document.getElementById('grid');
    const statusEl = document.getElementById('status');
    const scoreEl = document.getElementById('score');
    const messagesEl = document.getElementById('messages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');

    const size = 5; // one row of 5
    let tiles = new Array(size).fill(false);
    let joinTime = Date.now();
    let score = 0;

    function renderGrid(){
      gridEl.innerHTML = '';
      for (let i=0;i<size;i++){
        const btn = document.createElement('div');
        btn.className = tiles[i] ? 'light on' : 'light off';
        btn.dataset.idx = i;
        btn.innerText = tiles[i] ? 'ðŸ’¡' : '';
        btn.addEventListener('click', ()=> toggleTile(i));
        gridEl.appendChild(btn);
      }
    }

    function toggleTile(idx){
      const updates = {};
      updates['tiles/'+idx] = !tiles[idx]; // toggle on/off
      update(ref(db,'game'), updates);
    }

    function resetAll(){
      const updates = {};
      for (let i=0;i<size;i++) updates['tiles/'+i] = false;
      update(ref(db,'game'), updates);
    }

    function incrementScore(){
      update(ref(db,'game'), { score: score + 1 });
    }

    // Listen to game state
    onValue(ref(db,'game'), snapshot => {
      if (snapshot.exists()){
        const data = snapshot.val();
        tiles = data.tiles || new Array(size).fill(false);
        score = data.score || 0;
        renderGrid();
        scoreEl.textContent = `Times completed: ${score}`;
        statusEl.textContent = tiles.every(Boolean) ? "All ON! Resetting..." : "Playing";
        if (tiles.every(Boolean)){
          incrementScore();
          setTimeout(()=> resetAll(), 1000);
        }
      } else {
        resetAll();
      }
    });

    // Chat system
    sendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

    function sendMessage(){
      const text = chatInput.value.trim();
      if (!text) return;
      push(ref(db,'chat'), { text, time: Date.now() });
      chatInput.value = '';
    }

    // Only show messages after joinTime
    onChildAdded(ref(db,'chat'), snapshot => {
      const m = snapshot.val();
      if (m.time >= joinTime){
        const div = document.createElement('div');
        div.className = 'msg';
        div.textContent = m.text;
        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }
    });

    renderGrid();
    statusEl.textContent = "Connected";
  </script>
</body>
</html>
